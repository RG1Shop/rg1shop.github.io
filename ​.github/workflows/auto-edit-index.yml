# اسم سير العمل (يظهر في قائمة Actions)
name: تحديث تلقائي وتثبيت الإعلان والبحث (إصلاح نهائي)

# متى يعمل هذا الإجراء؟
on:
  push:
    branches:
      - main
      
# تعريف المهمة
jobs:
  تعديل_ودفع_التحديثات:
    runs-on: ubuntu-latest
    
    # خطوات العمل
    steps:
      - name: سحب الكود من المستودع
        uses: actions/checkout@v4
      
      - name: تنفيذ أوامر التعديل المعقدة (الإصلاح)
        run: |
          # 1. تعريف كود الإعلان المراد تثبيته (يجب استبدال "9876543210" بالمعرف الفعلي).
          # نستخدم التعليق لتسهيل البحث لاحقاً
          AD_UNIT='\n<div id="top-fixed-ad-unit" style="position: sticky; top: 57px; z-index: 999; width: 100%; background: #1f2937; padding: 5px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">\n    <div class="adsense-unit" style="margin: 0 auto; min-height: 50px; border: none; padding: 0;">\n        <ins class="adsbygoogle"\n             style="display:block; text-align:center;"\n             data-ad-client="ca-pub-9228235223985409"\n             data-ad-slot="9876543210"\n             data-ad-format="auto"\n             data-full-width-responsive="true"></ins>\n        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>\n    </div>\n</div>\n'
          
          # 2. تعريف كود أيقونة البحث
          SEARCH_BUTTON='\n        <a href="#search-section" class="main-nav-link search-icon-btn">\n            <i class="fas fa-search"></i> <span data-key="menu_search">بحث</span>\n        </a>\n'
          
          # 3. الإصلاح الحاسم: إدراج وحدة الإعلان المثبتة قبل تعليق Cookie Banner (نقطة ثابتة ومضمونة).
          sed -i '//i '"$AD_UNIT"'' Index.html
          
          # 4. الإصلاح الحاسم: إدراج أيقونة البحث بعد آخر رابط في شريط التنقل (نبحث عن سطر "تسوق</span>").
          # هذا يضمن أن يتم الإدراج داخل الـ <div id="main-categories-nav">
          sed -i '/تسوق<\/span>/a '"$SEARCH_BUTTON"'' Index.html
          
          # 5. خطوة تحقق: إضافة وسم تعليق فريد وواضح في نهاية الملف (لنرى هذا التعليق عند التحقق)
          echo "" >> Index.html
          
      - name: حفظ التغييرات ودفعها تلقائيًا
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'آلي: تطبيق إصلاح أوامر التعديل وتثبيت الإعلان والبحث'
          token: ${{ secrets.GITHUB_TOKEN }}
