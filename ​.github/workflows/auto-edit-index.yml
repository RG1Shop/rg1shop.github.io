# اسم سير العمل (يظهر في قائمة Actions)
name: تحديث تلقائي وتثبيت الإعلان والبحث

# متى يعمل هذا الإجراء؟
on:
  push:
    branches:
      - main
      
# تعريف المهمة
jobs:
  تعديل_ودفع_تاريخ_التحديث_والإعلانات:
    runs-on: ubuntu-latest
    
    # خطوات العمل
    steps:
      - name: سحب الكود من المستودع
        uses: actions/checkout@v4
      
      - name: تنفيذ أوامر التعديل المعقدة (إضافة البحث وتثبيت الإعلان)
        run: |
          # 1. تعريف كود الإعلان المراد تثبيته تحت شريط التنقل (يستخدم sed)
          # الإعلان مثبت عبر CSS عند ارتفاع 57px (وهو ارتفاع الشريط العلوي)
          # ملاحظة: تم استخدام "9876543210" كـ ad-slot. يجب استبداله بالمعرف الفعلي.
          AD_UNIT='\n<div id="top-fixed-ad-unit" style="position: sticky; top: 57px; z-index: 999; width: 100%; background: #1f2937; padding: 5px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">\n    <div class="adsense-unit" style="margin: 0 auto; min-height: 50px; border: none; padding: 0;">\n        <ins class="adsbygoogle"\n             style="display:block; text-align:center;"\n             data-ad-client="ca-pub-9228235223985409"\n             data-ad-slot="9876543210"\n             data-ad-format="auto"\n             data-full-width-responsive="true"></ins>\n        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>\n    </div>\n</div>\n'
          
          # 2. تعريف كود أيقونة البحث (إضافة زر بحث جديد إلى شريط التنقل)
          SEARCH_BUTTON='        <a href="#search-section" class="main-nav-link search-icon-btn">\n            <i class="fas fa-search"></i> <span data-key="menu_search">بحث</span>\n        </a>\n'
          
          # 3. إدراج وحدة الإعلان المثبتة بعد الشريط الرئيسي (قبل تعليق Cookie Banner)
          # نبحث عن سطر ونضيف كود الإعلان قبله.
          sed -i "//i $AD_UNIT" Index.html
          
          # 4. إدراج أيقونة البحث بعد آخر رابط في شريط التنقل
          # نبحث عن آخر رابط للتنقل <a href="#shopping-section" ...> ونضيف رابط البحث بعده.
          sed -i '/<a href="#shopping-section" class="main-nav-link">/a '"$SEARCH_BUTTON"'' Index.html
          
          # 5. إضافة وسم التعليق في نهاية الملف كتأكيد للتحديث
          echo "" >> Index.html
          
      - name: حفظ التغييرات ودفعها تلقائيًا
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'آلي: تثبيت إعلان AdSense وإضافة أيقونة البحث وتحديث التاريخ'
          token: ${{ secrets.GITHUB_TOKEN }}
